---
version: '3.7'
services:

  dynamicbeat-ci:
    build:
      context: .
      dockerfile: dynamicbeat.Dockerfile
      target: ci
    environment:
      GOPATH: /home/scorestack/go
    image: dynamicbeat-ci:latest
    volumes:
      - "../:/home/scorestack/go/src/github.com/s-newman/scorestack"
      - "./scripts/dynamicbeat:/scripts"
      - "/var/run/docker.sock:/var/run/docker.sock"
    user: scorestack

  dynamicbeat-devcontainer:
    build:
      context: .
      dockerfile: dynamicbeat.Dockerfile
      target: devcontainer
    command: /bin/sh -c "while sleep 1000; do :; done"
    environment:
      GOPATH: /home/scorestack/go
    image: dynamicbeat-devcontainer:latest
    volumes:
      - ../:/home/scorestack/go/src/github.com/s-newman/scorestack
      - "/var/run/docker.sock:/var/run/docker.sock"
    user: scorestack

  kibana-ci:
    build:
      context: .
      dockerfile: kibana.Dockerfile
      target: ci
    image: kibana-ci:latest
    volumes:
      - "../kibana-plugin:/home/scorestack/kibana/plugins/scorestack"
      - "./scripts/kibana:/scripts"
    user: node